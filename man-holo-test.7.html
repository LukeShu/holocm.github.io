<!doctype html>
<html lang="de">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Holo - Minimalistic Configuration Management</title>
    <link rel="stylesheet" type="text/css" href="./site.css">
    <link rel="stylesheet" type="text/css" href="./font/font-awesome.min.css">
    
</head>
<body>
    <header>
        <div id="header-container">
            <div id="header-icon" class="fixed-width">
                <a href="index.html"><img src="img/holo-logo.svg" alt="Holo"></a>
            </div>
            <div id="header-buttons" class="fixed-width">
                <a href="https://twitter.com/holocm" title="Follow on Twitter"><i class="fa fa-twitter"></i></a>
                <a href="https://github.com/holocm/holo" title="Fork on GitHub"><i class="fa fa-github"></i></a>
            </div>
        </div>
    </header>
    <div id="section-container">
        <section><div class="fixed-width clearfix"><h1 id="Name">Name</h1>

<p>/usr/lib/holo/holo-test - test runner for Holo plugins</p>

</div></section><section><div class="fixed-width clearfix"><h1 id="Synopsis">Synopsis</h1>

<pre><code>/usr/lib/holo/holo-test &lt;object name&gt; &lt;directory&gt;...</code></pre>

</div></section><section><div class="fixed-width clearfix"><h1 id="Description">Description</h1>

<p>Holo plugins can be tested by executing Holo commands on fabricated file system trees, and comparing the output and resulting file system with the expected results. The <b>holo-test</b> program is a test runner for such test cases.</p>

<p>The standard layout for test cases looks like this:</p>

<pre><code>/path/to/test/case/       &lt;-- the directory for the test case
    source/               &lt;-- the root directory before running `holo apply`
    target/               &lt;-- the root directory after running `holo apply` (generated by holo-test)
    scan-output           &lt;-- the expected output of `holo scan`  (minus colors, generated by holo-test)
    apply-output          &lt;-- the expected output of `holo apply` (minus colors, generated by holo-test)
    tree                  &lt;-- a dump of the actual files in the target/ directory after running `holo apply` (generated by holo-test)
    expected-tree         &lt;-- what we expect to be in ./tree
    expected-scan-output  &lt;-- what we expect to be in ./scan-output
    expected-apply-output &lt;-- what we expect to be in ./apply-output</code></pre>

<h2 id="Running-a-test">Running a test</h2>

<p>To run any number of tests, invoke holo-test with the name of the thing you&#39;re testing (typically the name of a Holo plugin), followed by the paths of the test case directories. The first argument is only used for formatting the output.</p>

<pre><code>$ holo-test &#39;holo-files plugin&#39; ./tests/holo-files/*
&gt;&gt; Running test case tests/holo-files/01-first...
&gt;&gt; Running test case tests/holo-files/02-second...
&gt;&gt; Running test case tests/holo-files/03-third...
&gt;&gt; All tests for holo-files plugin completed successfully.</code></pre>

<p>The test will usually output just a progress display (one line per test case). If a test fails, the failing parts will be printed on the command line. To flag test failure when run in Continuous Integration setups, <code>holo-test</code> will exit with non-zero status when one or more test cases fail.</p>

<h2 id="Writing-new-test-cases">Writing new test cases</h2>

<p>There are plenty of files checked into version control for each test case, but luckily you can have <code>holo-test</code> generate most of them for you. To create a new test case, create an empty test case directory and put in there</p>

<dl>

<dt id="README"><code>README</code></dt>
<dd>

<p>A read-me of some sort is recommended to explain what the test case covers.</p>

</dd>
<dt id="source"><code>source/</code></dt>
<dd>

<p>This contains the filesystem tree with all the files relevant for the test. The test then consists of running</p>

<pre><code>holo scan
holo diff
holo apply
holo apply --force # maybe, see below</code></pre>

<p>in a quasi-chroot here and seeing what output it produces and what it does to this filesystem tree. If the output of <code>holo apply</code> mentions the word <code>--force</code>, then <code>holo apply --force</code> is run, too. This covers cases where plugins refuse to overwrite modified entities, printing instead something like:</p>

<pre><code>!! Target has been modified (use --force to overwrite)</code></pre>

</dd>
<dt id="source-etc-holorc"><code>source/etc/holorc</code></dt>
<dd>

<p>When you&#39;re testing a plugin that&#39;s not yet installed, you need to tell Holo to pick it up from the proper location. There&#39;s a special syntax allowed in holorc for that:</p>

<pre><code>plugin foobar=../../../build/holo-foobar</code></pre>

<p>The path must be relative to the test case directory, since that&#39;s the working directory where Holo is run.</p>

</dd>
</dl>

<p>Now run your test case. It will obviously fail since all the files that it compares its build results to are missing. But we can use these build results as basis for the missing files. Copy</p>

<pre><code>tree               -&gt; expected-tree
apply-output       -&gt; expected-apply-output
scan-output        -&gt; expected-scan-output
apply-force-output -&gt; expected-apply-force-output (if it&#39;s there)</code></pre>

<p>And the most important step of them all, before checking them into source control, verify carefully that these files really contain the *expected* results of the test case run. When that is done, your test case should now pass. Or not, if the code needs fixing. ;)</p>

</div></section><section><div class="fixed-width clearfix"><h1 id="See-also">See also</h1>

<p><a href="http://man.he.net/man8/holo">holo(8)</a>, <a href="http://man.he.net/man7/holo-plugin-interface">holo-plugin-interface(7)</a></p>

</div></section><section><div class="fixed-width clearfix"><h1 id="Author">Author</h1>

<p>Stefan Majewsky</p>

<p>Further documentation is available at the project homepage: http://holocm.org</p>

<p>Please report any issues and feature requests at Github: http://github.com/holocm/holo/issues</p></div></section>
    </div>
    <footer>
        <div class="fixed-width clearfix">
            This website is made with <a href="http://montserrat.zkysky.com.ar/en">Montserrat</a>
            and <a href="http://fontawesome.io">FontAwesome</a>
            and <a href="https://github.com/holocm/holocm.github.io">maintained at GitHub</a>.
        </div>
    </footer>
</body>
</html>
