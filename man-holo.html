<!doctype html>
<html lang="de">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Holo - Minimalistic Configuration Management</title>
    <link rel="stylesheet" type="text/css" href="./site.css">
    <link rel="stylesheet" type="text/css" href="./font/font-awesome.min.css">
    
</head>
<body>
    <header>
        <div id="header-container">
            <div id="header-icon" class="fixed-width">
                <a href="index.html"><img src="img/holo-logo.svg" alt="Holo"></a>
            </div>
            <div id="header-buttons" class="fixed-width">
                <a href="https://twitter.com/holocm" title="Follow on Twitter"><i class="fa fa-twitter"></i></a>
                <a href="https://github.com/holocm/holo" title="Fork on GitHub"><i class="fa fa-github"></i></a>
            </div>
        </div>
    </header>
    <div id="section-container">
        <section><div class="fixed-width clearfix"><h1 id="Name">Name</h1>

<p>holo - minimal configuration management</p>

</div></section><section><div class="fixed-width clearfix"><h1 id="Synopsis">Synopsis</h1>

<p>holo <b>apply</b> [<i>-f|--force</i>] [<i>entity</i> ...]</p>

<p>holo <b>diff</b> [<i>entity</i> ...]</p>

<p>holo <b>scan</b> [<i>-s|--short</i>] [<i>entity</i> ...]</p>

<p>holo <b>--help|--version</b></p>

</div></section><section><div class="fixed-width clearfix"><h1 id="Description">Description</h1>

<p>Holo adds a few sprinkles on top of package management to make it suitable for basic configuration management tasks. Its prime directive is to have all configuration statically declared and defined within packages, which can be installed to add new configuration, or uninstalled to remove configuration from a system.</p>

<p>Package management already offers 99% of the needed tools: Metapackages (usually called &quot;holograms&quot; or &quot;holodecks&quot; in Holo) can pull in other packages as dependencies, thus installing the software required for a certain task, and contain their own files to configure the software installed.</p>

<p>Holo adds facilties to work around shortcomings (from the configuration management perspective) of the package management.</p>

<h2 id="Provisioning-of-files-via-the-configuration-repository">Provisioning of files via the configuration repository</h2>

<p>The configuration repository at <i>/usr/share/holo/repo</i> can be used to resolve file conflicts when multiple packages (holograms or system packages) work on the same configuration file. Each file in the repository works on a certain <b>target</b>, as determined by its file name:</p>

<pre><code>/usr/share/holo/repo/20-webserver/etc/nginx/nginx.conf
                      ^          --+------------------
                      |            |
                      |            +-- path to target
                      |
                      +-- disambiguator</code></pre>

<p>The disambiguator is always required, and allows multiple repository entries to operate on the same target (sorted alphabetically by their disambiguator). The pattern of putting a number at the start of the disambiguator is not required, but useful to control the ordering of repo files.</p>

<p>Repository entries are applied on the <b>target base</b>, the initial version of the target that was found at the target path during the first <code>holo apply</code> run. This target base is saved at <i>/var/lib/holo/base/$target</i> and will be updated automatically when the package management installed an updated version of the target base as <i>$target.rpmnew</i>, <i>$target.dpkg-dist</i>, etc. (The exact paths depend on the package manager.)</p>

<p>Repository entries that are plain files or symlinks will just overwrite the target base (or all previous entries), whereas executable repository entries with an extra <code>.holoscript</code> suffix can be used to modify the target base (or the result of a previous application step). The target contents will be piped through the script. This is typically used when the default configuration for an application shall be used, but with some minor modifications. The following example uses the default configuration for <a href="http://man.he.net/man8/pacman">pacman(8)</a>, but enables the &quot;Color&quot; option:</p>

<pre><code>$ cat /usr/share/holo/repo/20-enable-color/etc/pacman.conf.holoscript
#!/bin/sh
sed &#39;s/^#\s*Color$/Color/&#39;

$ sudo holo apply /etc/pacman.conf

Working on /etc/pacman.conf
  store at /var/lib/holo/base/etc/pacman.conf
  passthru /usr/share/holo/repo/20-enable-color/etc/pacman.conf.holoscript</code></pre>

<p>When writing the new target file, ownership and permissions will be copied from the target base, and thus from the original target file. Furthermore, a copy of the provisioned target file is written to <i>/var/lib/holo/provisioned/$target</i> for use by <code>holo diff $target</code>.</p>

<h2 id="Provisioning-of-user-accounts-and-groups">Provisioning of user accounts and groups</h2>

<p>Entity definitions can be added to automatically provision user accounts and groups to <a href="http://man.he.net/man5/passwd">passwd(5)</a> and <a href="http://man.he.net/man5/group">group(5)</a>. Provisioning uses the standard commands <a href="http://man.he.net/man8/useradd">useradd(8)</a>, <a href="http://man.he.net/man8/usermod">usermod(8)</a>, <a href="http://man.he.net/man8/groupadd">groupadd(8)</a> and <a href="http://man.he.net/man8/groupmod">groupmod(8)</a>.</p>

<p>Entity definitions are placed at <i>/usr/share/holo/*.toml</i> and are written in TOML. The following fields are accepted for users and groups:</p>

<pre><code>[[group]]
name    = &quot;mygroup&quot;            # string,  the group name
system  = false                # if true, gives --system to groupadd
gid     = 1001                 # integer, given to groupadd as --gid

[[user]]
name    = &quot;myuser&quot;             # string,  the user name
system  = false                # if true, gives --system to useradd
comment = &quot;My Own User&quot;        # string,  given to useradd as --comment
uid     = 1023                 # integer, given to useradd as --uid
group   = &quot;mygroup&quot;            # string,  given to useradd as --gid
groups  = [ &quot;audio&quot;, &quot;video&quot; ] # strings, given to useradd as --groups
home    = &quot;/var/lib/myuser&quot;    # string,  given to useradd as --home-dir
shell   = &quot;/usr/bin/zsh&quot;       # string,  given to useradd as --shell</code></pre>

<p>In either case, <code>name</code> is the only required attribute. Multiple entity definitions may apply to the same entity if they have the same <code>name</code> attribute. This can be useful if a base hologram creates the entity and a later hologram requires more specific configuration for this entity. When entity definitions are stacked on each other, they are not allowed to contradict one another. (Different lists of auxiliary groups are allowed and will be merged.)</p>

<h2 id="Running-custom-scripts-during-provisioning">Running custom scripts during provisioning</h2>

<p>Executable files placed at <i>/usr/share/holo/provision/</i> will be run (in alphabetical order) by <code>holo apply</code> after all other entities (files, users and groups) have been provisioned.</p>

<h2 id="Dealing-with-manual-changes">Dealing with manual changes</h2>

<p>When an entity (target file, user or group) provisioned by Holo is modified by the user or another program, the next <code>holo apply</code> run will complain about this and refuse to overwrite the manual changes.</p>

<pre><code>$ sudo rm /etc/pacman.conf
$ sudo usermod --uid 2003 user:test
$ sudo holo apply /etc/pacman.conf

Working on target/etc/pacman.conf
     apply target/usr/share/holo/repo/01-base/etc/pacman.conf

!! skipping target: file has been deleted by user (use --force to restore)

Working on user:test
  found in target/usr/share/holo/01-base.toml
      with UID: 1003

!! User has UID: 2003, expected 1003 (use --force to overwrite)</code></pre>

<p>The difference between the last provisioned and the actual entity can be inspected in detail with <code>holo diff</code>, and as suggested in the error messages, <code>holo apply --force</code> will restore the entities to the state described by the configuration repository.</p>

</div></section><section><div class="fixed-width clearfix"><h1 id="Operations">Operations</h1>

<p>All operations act on all entities (target files, users and groups) by default, but can be restricted to certain entities by adding their names to the command line. Target files are identified by their absolute path (e.g. <code>/etc/sddm/sddm.conf</code>), users and groups are identifed as <code>type:name</code>, e.g. <code>user:mysql</code> or <code>group:sudo</code>).</p>

<dl>

<dt id="apply--f---force-entity"><b>apply</b> [<i>-f|--force</i>] [<i>entity</i> ...]</dt>
<dd>

<p>Read the configuration repository and entity definitions and apply the selected (or all) targets. Also, when repository files or target files have been deleted, but there still exist target bases in <i>/var/lib/holo/base</i>, scrub these.</p>

<p>Scrubbing means to delete the target base if the target file has also been deleted, or to restore the target base when only the repository entries have been deleted. You can always run <code>holo scan</code> beforehand to check what will be done.</p>

<p>By default, Holo will refuse to provision entities that have been changed by the user or by other programs. Apply <b>--force</b> to overwrite such changes.</p>

</dd>
<dt id="diff-entity"><b>diff</b> [<i>entity</i> ...]</dt>
<dd>

<p>Print a <a href="http://man.he.net/man1/diff">diff(1)</a> between the last provisioned version of each selected target file and the actual contents of that target file.</p>

</dd>
<dt id="scan--s---short-entity"><b>scan</b> [<i>-s|--short</i>] [<i>entity</i> ...]</dt>
<dd>

<p>Read the configuration repository and entity definitions, and report what <code>holo apply</code> will do to apply these entities. This acts like a dry run for <code>holo apply</code> that usually does not require super-user privileges.</p>

<p>With <b>--short</b>, only lists the names of all entities.</p>

</dd>
</dl>

</div></section><section><div class="fixed-width clearfix"><h1 id="Options">Options</h1>

<dl>

<dt id="help"><b>--help</b></dt>
<dd>

<p>Print out usage information.</p>

</dd>
<dt id="version"><b>--version</b></dt>
<dd>

<p>Print out Holo&#39;s version string including the release name.</p>

</dd>
</dl></div></section>
    </div>
    <footer>
        <div class="fixed-width clearfix">
            This website is made with <a href="http://montserrat.zkysky.com.ar/en">Montserrat</a>
            and <a href="http://fontawesome.io">FontAwesome</a>
            and <a href="https://github.com/holocm/holocm.github.io">maintained at GitHub</a>.
        </div>
    </footer>
</body>
</html>
