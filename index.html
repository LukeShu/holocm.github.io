<!doctype html>
<html lang="de">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Holo - Minimalistic configuration management</title>
    <link rel="stylesheet" type="text/css" href="./site.css">
    <link rel="stylesheet" type="text/css" href="./font/font-awesome.min.css">
    <!-- TODO: favicon, apple-touch-icon -->
</head>
<body>
    <header id="pitch">
        <div id="header-container">
            <div id="header-icon" class="fixed-width">
                <a href="index.html"><img src="img/holo-logo.svg" alt="Holo"></a>
            </div>
            <div id="header-buttons" class="fixed-width">
                <a href="https://twitter.com/holocm" title="Follow on Twitter"><i class="fa fa-twitter"></i></a>
                <a href="https://github.com/majewsky/holo" title="Fork on GitHub"><i class="fa fa-github"></i></a>
            </div>
        </div>
        <div id="pitch-container" class="fixed-width">
            <div id="pitch-content">
                <table cellpadding="0" cellspacing="0"><tr>
                    <td class="logo"><img src="img/logo.png"></td>
                    <td class="pitch">
                        <p>Configuration management tools are vast.</p>
                        <p>And then there's Holo.</p>
                    </td>
                </tr></table>
                <p>Holo builds on the package management of your Linux system and adds a
                minimal set of additional features to manage your system's configuration.</p>
                <p><a class="button" href="01-hello-world.html" onclick="alert('This part is still under construction. Meanwhile, you can have a look at the user documentation below.');return false;">See how it works</a></p>
                <p id="plz-scroll">Or scroll down for the user documentation.</p>
            </div>
        </div>
    </header>
    <section>
        <div class="fixed-width clearfix">
            <h1>Installation</h1>
            <p>The recommended method, if possible, is to install Holo as a package.</p>
            <ul>
                <li>Arch Linux users can use the <a href="https://aur.archlinux.org/packages/holo">AUR package</a>.</li>
                <li>If you have packaged Holo for your distribution, please <a href="https://github.com/majewsky/majewsky.github.io/issues/new">send me a link</a> that I can add to this list.</li>
            </ul>
            <p>
                Alternatively, to install from source, clone the
                <a href="https://github.com/majewsky/holo">Git repository</a>
                and build the master branch:
            </p>
            <pre>
$ git clone https://github.com/majewsky/holo
$ cd holo
$ make
$ make check
$ sudo make install</pre>
            <p>
                You need <a href="https://golang.org">Go</a> to compile Holo and
                <a href="https://www.perl.org">Perl</a> to run the testcase.
                Packages for Go and Perl are available for all major distributions.
                Note that these are all build-time dependencies; when
                installed, Holo is a single static binary (plus manpage) that
                depends only on a UNIX kernel.
            </p>
            <!-- TODO: reference manpage, bring manpage in sync with this document -->
        </div>
    </section>
    <section>
        <div class="fixed-width clearfix">
            <h1>Building holograms</h1>
            <p>
                In Holo, configuration is deployed in packages using the
                standard package management tools of your Linux distribution, so
                first, you should familiarize yourself with building and
                installing such packages. When administrating multiple systems,
                it is good practice to create a package repository to distribute
                configuration updates. To differentiate configuration packages
                from the application packages provided by your distribution,
                we're going to call these <i>holograms</i>.
            </p>
            <p>
                The package management allows us to specify application packages
                and other holograms as dependencies of our hologram, and put
                configuration files into the hologram. Holo only comes into play
                when we go beyond the capabilities of the package management.
            </p>
        </div>
    </section>
    <section>
        <div class="fixed-width clearfix">
            <h1>The configuration repository</h1>
            <p>
                Package management does not allow multiple packages to install a
                file in the same location. So when an application package
                installs a default configuration file, a hologram cannot
                directly overwrite this configuration file.
            </p>
            <pre>
$ pacman -Qo /etc/nginx/nginx.conf
/etc/nginx/nginx.conf is owned by nginx 1.8.0-1</pre>
            <p>
                Instead, Holo offers a configuration repository at
                <tt>/holo/repo</tt> where the hologram can put its configuration
                file.
            </p>
            <pre>
$ pacman -Qo /holo/repo/20-webserver/etc/nginx/nginx.conf
/holo/repo/20-webserver/etc/nginx/nginx.conf is owned by hologram-webserver 1.0.0-1</pre>
            <p>
                The <tt>holo apply</tt> command is then used to install the
                hologram's configuration file in the right place. Most package
                management tools allow packages to carry post-install hooks for
                this purpose.
            </p>
            <pre>
$ sudo holo apply
[holo] Working on /etc/nginx/nginx.conf
[holo]   store at /holo/backup/etc/nginx/nginx.conf
[holo]      apply /holo/repo/20-webserver/etc/nginx/nginx.conf</pre>
            <p>
                Entries in the configuration repository follow a fixed naming scheme:
            </p>
            <pre>
/holo/repo/20-webserver/etc/nginx/nginx.conf
 ^          ^            ^
 |          |            |
 |          |            +-- path to target
 |          |
 |          +-- disambiguator
 |
 +-- repository path</pre>
            <p>
                The disambiguator is always required, and allows multiple
                repository files to operate on the same target (sorted
                alphabetically by their disambiguator). The pattern of putting
                a number at the start of the disambiguator is not required, but
                useful to control the ordering of repo files.
            </p>
        </div>
    </section>
    <section>
        <div class="fixed-width clearfix">
            <h1>Application strategies</h1>
            <p>
                When the repository file is a plain file or a symlink, the
                default strategy (&quot;apply&quot;) is to copy this file to the
                target location. Symlink targets are copied verbatim, so
                relative symlinks should be relative to the target directory.
            </p>
            <p>
                When the repository file is an executable file or a symlink to
                an executable file carrying the extra <tt>.holoscript</tt>
                extension, the script is executed and the contents of the original
                file are piped through it to obtain the resulting configuration
                file. This strategy is called &quot;passthru&quot; in the output
                of <tt>holo apply</tt> and <tt>holo scan</tt>.
            </p>
            <p>
                For example, the following setup installs the default
                configuration for Pacman, but enables the &quot;Color&quot;
                option which is commented out in the default configuration.
            </p>
            <pre>
$ holo scan
...
/etc/pacman.conf
    store at /holo/backup/etc/pacman.conf
    passthru /holo/repo/20-enable-color/etc/pacman.conf.holoscript
...
$ cat /holo/repo/20-enable-color/etc/pacman.conf.holoscript
#!/bin/sh
sed 's/^#\s*Color$/Color/'</pre>
            <p>
                The advantage of holoscripts over plain configuration files is
                that when the default configuration is updated, you get the
                updates as well during the next <tt>holo apply</tt>.
            </p>
            <pre>
$ sudo pacman -Syu
...
(3/8) upgrading pacman
warning: /etc/pacman.conf installed as /etc/pacman.conf.pacnew
... </pre>
            <p>
                In this example, the system update includes a new default
                configuration, which is placed next to the currently used
                configuration. Holo will recognize this and use the new default
                configuration:
            </p>
            <pre>
$ sudo holo apply
...
[holo] Working on /etc/pacman.conf
[holo]     update /etc/pacman.conf.pacnew -&gt; /holo/backup/etc/pacman.conf
[holo]   passthru /holo/repo/20-enable-color/etc/pacman.conf.holoscript
... </pre>
            <p>
                Another advantage is that multiple holoscripts can be chained.
                Multiple holograms can thus modify the same default
                configuration, or further specialize a base configuration
                provided by a base hologram:
            </p>
            <pre>
$ holo scan
...
/etc/pacman.conf
    store at /holo/backup/etc/pacman.conf
       apply /holo/repo/00-base/etc/pacman.conf
    passthru /holo/repo/10-add-catalyst-repo/etc/pacman.conf.holoscript
    passthru /holo/repo/20-enable-color/etc/pacman.conf.holoscript
... </pre>
            <p>
                As seen in this example, the disambiguator is used to determine
                the application order when multiple repository files work on
                the same target. There is no restriction on how repository
                files are ordered. When somewhere in the application chain, a
                plain file is found, the effects of all previous application
                steps are discarded and overwritten by that config file.
            </p>
        </div>
    </section>
    <section>
        <div class="fixed-width clearfix">
            <h1>The backup directory</h1>
            <p>
                Before Holo overwrites the default configuration supplied by
                the application package, it always takes a copy which is placed
                below <tt>/holo/backup</tt>. This typically happens only once.
                The first <tt>holo apply</tt> after installing a new hologram
                might look like this:
            </p>
            <pre>
$ sudo holo apply
[holo] Working on /etc/nginx/nginx.conf
[holo]   store at /holo/backup/etc/nginx/nginx.conf
[holo]      apply /holo/repo/20-webserver/etc/nginx/nginx.conf</pre>
            <p>
                But when <tt>holo apply</tt> is run again, it recognizes that
                the backup is already up-to-date:
            </p>
            <pre>
$ sudo holo apply
[holo] Working on /etc/nginx/nginx.conf
[holo]      apply /holo/repo/20-webserver/etc/nginx/nginx.conf</pre>
            <p>
                Besides allowing the user to inspect the default configuration,
                this backup serves two purposes: First, it is used as a base
                for applying holoscripts. Second, the owner, group, permissions
                and timestamps of the target configuration are always copied
                from this backup, and thus match the corresponding metadata of
                the default configuration.
            </p>
        </div>
    </section>
    <footer>
        <div class="fixed-width clearfix">
            <p>
                This website is made with <a href="http://montserrat.zkysky.com.ar/en">Montserrat</a>
                and <a href="http://fontawesome.io">FontAwesome</a>
                and <a href="https://github.com/majewsky/majewsky.github.io">maintained at GitHub</a>.
            </p>
        </div>
    </footer>
</body>
</html>
