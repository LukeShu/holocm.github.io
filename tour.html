<!doctype html>
<html lang="de">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Holo - Minimalistic Configuration Management</title>
    <link rel="stylesheet" type="text/css" href="./site.css">
    <link rel="stylesheet" type="text/css" href="./font/font-awesome.min.css">
    
</head>
<body>
    <header>
        <div id="header-container">
            <div id="header-icon" class="fixed-width">
                <a href="index.html"><img src="img/holo-logo.svg" alt="Holo"></a>
            </div>
            <div id="header-buttons" class="fixed-width">
                <a href="https://twitter.com/holocm" title="Follow on Twitter"><i class="fa fa-twitter"></i></a>
                <a href="https://github.com/holocm/holo" title="Fork on GitHub"><i class="fa fa-github"></i></a>
            </div>
        </div>
    </header>
    <div id="section-container">
        <section><div class="fixed-width clearfix"><h1 id="Configuration-in-packages">1. Configuration in packages</h1>

<p>Configuring a service usually includes installing the application and placing some configuration files in the right locations. We can do both with a system package. For example, let&#39;s configure <code>haveged</code>. And to make this example distribution-independent, let&#39;s use <code>holo-build</code> to build the package from a short and readable description file:</p>

<pre><code>$ cat &gt; configure-haveged.pkg.toml

[package]
name     = &quot;configure-haveged&quot;
version  = &quot;1.0.0&quot;
requires = [ &quot;haveged&quot; ]

[[symlink]]
path   = &quot;/etc/systemd/system/multi-user.target.wants/haveged.service&quot;
target = &quot;/usr/lib/systemd/system/haveged.service&quot;

$ holo-build &lt; configure-haveged.pkg.toml</code></pre>

<p>This generates a system package that pulls in the desired application as a dependency and installs the necessary configuration files. In this case, that&#39;s only one symlink in the right place to enable haveged as a systemd service.</p>

</div></section><section><div class="fixed-width clearfix"><h1 id="Where-the-package-management-fails">2. Where the package management fails</h1>

<p>Let&#39;s look at a second example, and set up an nginx webserver. Again, we pull in nginx as a dependency, and enable it in systemd.</p>

<pre><code>$ cat &gt; configure-mywebserver.pkg.toml

[package]
name     = &quot;configure-mywebserver&quot;
version  = &quot;1.0.0&quot;
requires = [ &quot;nginx&quot; ]

[[symlink]]
path   = &quot;/etc/systemd/system/multi-user.target.wants/nginx.service&quot;
target = &quot;/usr/lib/systemd/system/nginx.service&quot;

[[file]]
path        = &quot;/etc/nginx/nginx.conf&quot;
contentFrom = &quot;nginx.conf&quot;

$ holo-build &lt; configure-mywebserver.pkg.toml</code></pre>

<p>This time, we add a configuration file (which I&#39;ve omitted here for brevity), but when trying to install the package, this produces an error:</p>

<pre><code>$ sudo pacman -U configure-mywebserver-1.0.0-1-any.tar.xz # install package
...
(1/1) checking package integrity
(1/1) loading package files
(1/1) checking for file conflicts
error: failed to commit transaction (conflicting files)
configure-mywebserver: /etc/nginx/nginx.conf exists in filesystem
...
$ pacman -Qo /etc/nginx/nginx.conf # who owns this file?
/etc/nginx/nginx.conf is owned by nginx 1.8.0-1</code></pre>

<p>The nginx package contains an example configuration which is installed in the same location. The package management cannot resolve this file conflict because it does not know which package takes precedence.</p>

</div></section><section><div class="fixed-width clearfix"><h1 id="Resolving-the-conflicts-with-Holo">3. Resolving the conflicts with Holo</h1>

<p>Holo&#39;s initial motivation was to resolve exactly these file conflicts. Since we&#39;re in the domain of configuration management, we know that our configuration takes precedence over the default configuration. But since the package management insists on putting the default configuration where it is, we have to fix that after the fact. For now, let&#39;s install our configuration in a different location:</p>

<pre><code>$ cat &gt; configure-mywebserver.pkg.toml

[package]
name     = &quot;configure-mywebserver&quot;
version  = &quot;1.0.0&quot;
requires = [ &quot;nginx&quot; ]

[[symlink]]
path   = &quot;/etc/systemd/system/multi-user.target.wants/nginx.service&quot;
target = &quot;/usr/lib/systemd/system/nginx.service&quot;

[[file]]
path        = &quot;/usr/share/holo/repo/10-mywebserver/etc/nginx/nginx.conf&quot;
contentFrom = &quot;nginx.conf&quot;

$ holo-build &lt; configure-mywebserver.pkg.toml</code></pre>

<p>The configuration file has been moved to Holo&#39;s configuration repository below <i>/usr/share/holo/repo</i>. (Don&#39;t worry about the <code>10-mywebserver</code> bit for now, we&#39;ll see why it&#39;s useful in the next example.) Since <code>holo-build</code> knows what this is, it has automatically added <code>holo</code> as a dependency for the package:</p>

<pre><code>$ pacman -Qip configure-mywebserver-1.0.0-2-any.tar.xz
...
Depends On     : nginx  holo
...</code></pre>

<p>And it has added a post-install script to the package that runs:</p>

<pre><code># holo apply

Working on /etc/nginx/nginx.conf
  store at /var/lib/holo/base/etc/nginx/nginx.conf
     apply /usr/share/holo/repo/10-mywebserver/etc/nginx/nginx.conf</code></pre>

<p>Of course you can use <code>holo</code> without <code>holo-build</code>, too, by building packages with the standard distribution tools.</p>

</div></section><section><div class="fixed-width clearfix"><h1 id="Advanced-features">4. Advanced features</h1>

<p>To add to our previous scenario, let&#39;s assume that we have successfully rolled out the <code>configure-mywebserver</code> package to multiple systems, and the configuration is such that the server listens on port 80. But there is this one system where we cannot use it yet because another webserver is already running on port 80. If we want to install it, we need to change the configuration just a little bit so that nginx listens on port 8080 instead.</p>

<p>Holo can help with that, too. Let&#39;s build a new configuration package that builds on the previous one, by installing it as a dependency.</p>

<p>We want to reuse our configuration from before, but change it slightly. Thankfully, Holo&#39;s configuration repository can not only contain complete configuration files, but also scripts that modify the configuration file (identified by the <code>.holoscript</code> extension):</p>

<pre><code>$ cat &gt; configure-mywebserver-alternateport.pkg.toml

[package]
name     = &quot;configure-mywebserver-alternateport&quot;
version  = &quot;1.0.0&quot;
requires = [ &quot;configure-mywebserver&quot; ]

[[file]]
path    = &quot;/usr/share/holo/repo/20-alternate-port/etc/nginx/nginx.conf.holoscript&quot;
mode    = &quot;0755&quot;
content = &quot;&quot;&quot;
    #!/bin/sh
    sed &#39;s/listen\s*80;/listen 8080;/&#39;
&quot;&quot;&quot;

$ holo-build &lt; configure-mywebserver-alternateport.pkg.toml</code></pre>

<p>A holoscript receives the original configuration file on stdin and prints the modified version on stdout. In this case, we modify the <code>listen 80</code> directive. When running <code>holo apply</code> while installing the package, this script will be applied to the configuration from the previous configuration package.</p>

<pre><code># holo apply

Working on /etc/nginx/nginx.conf
     apply /usr/share/holo/repo/10-mywebserver/etc/nginx/nginx.conf
  passthru /usr/share/holo/repo/20-alternate-port/etc/nginx/nginx.conf.holoscript</code></pre>

<p>The order in which repository files are applied is defined by the directory names below <i>/usr/share/holo/repo</i> (<code>10-mywebserver</code> and <code>20-alternate-port</code>), which we call <i>disambiguators</i>.</p>

<p>Holoscripts can also be used on their own, without a plain configuration coming before it. In this case, the holoscript modifies the default configuration installed by the application package.</p>

</div></section><section><div class="fixed-width clearfix"><h1 id="Just-how-tiny-is-Holo">5. Just how tiny is Holo?</h1>

<p>This tiny:</p>

<pre><code>$ ls -lh /usr/bin/holo*
-rwxr-xr-x 1 root root 2,8M  6. Nov 22:38 /usr/bin/holo
-rwxr-xr-x 1 root root 2,6M  6. Nov 22:38 /usr/bin/holo-build</code></pre>

<p>Holo comes in two static binaries which are trivial to deploy even during initial setup of your system. To install it on your system as well, have a look at the user documentation.</p>

<p class="follow"><a href="./doc.html">Read the documentation Â»</a></p></div></section>
    </div>
    <footer>
        <div class="fixed-width clearfix">
            This website is made with <a href="http://montserrat.zkysky.com.ar/en">Montserrat</a>
            and <a href="http://fontawesome.io">FontAwesome</a>
            and <a href="https://github.com/holocm/holocm.github.io">maintained at GitHub</a>.
        </div>
    </footer>
</body>
</html>
